{% extends "base.html" %}

{% load sekizai_tags %}

{% block content %}
    {% addtoblock "js" %}
    <script type="text/javascript" src="{{ STATIC_URL }}bootstrap/js/bootstrap.min.js"></script>

    <!-- backbone -->
    <script type="text/javascript" src="{{ STATIC_URL }}contrib/backbone/ICanHaz.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}contrib/backbone/json2.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}contrib/backbone/underscore-min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}contrib/backbone/backbone-min.js"></script>

    <script type="text/javascript" src="{{ STATIC_URL }}/js/passwords.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}/js/contacts.js"></script>
    {% endaddtoblock %}

    <h1 class="page-header">Passwords</h1>

    <div id="contactPanel">
        <h2>Find contacts</h2>
        <p>Search for other users to share passwords with by username:</p>
        <form class="form-search">
            <input type="text" placeholder="Enter username" 
                   class="search-query" id="userSearch" />
            <input class="btn" type="submit" value="Search" />
        </form>

        <table class="table table-striped">
            <thead>
              <tr>
                <th>Name</th>
                <th>User name</th>
                <th>Actions</th>
              </tr>
            </thead>
        </table>
    </div>

    <div id="passwordPanel">
        <table class="table table-striped">
            <thead>
              <tr>
                <th>Title</th>
                <th>User name</th>
                <th>Password</th>
                <th>Notes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tfoot>
                <tr>
                    <td colspan="5">
                        <button class="btn btn-primary" data-toggle="modal"
                                href="#passwordModal">Add new password</button>
                    </td>
                </tr>
            </tfoot>
        </table>

        <div class="modal hide fade" id="passwordModal">
            <form method="post" id="passwordForm">
              <div class="modal-header">
                <button data-dismiss="modal" class="close">Ã—</button>
                <h3>Password Details</h3>
              </div>
              <div class="modal-body">
                    {{ form }}
                    {% csrf_token %}
              </div>
              <div class="modal-footer">
                <a class="btn" href="#" data-dismiss="modal">Cancel</a>
                <input type="submit" class="btn btn-primary" value="Save" />
              </div>
            </form>
        </div>
    </div>

    {% load verbatim %}

    <!-- ICanHaz templates -->
    {% comment %}
    Mustache and django both use {{}} tags for templates, so we need to use
    a custom template tag to output the mustache template exactly as it is.
    {% endcomment %}
    {% verbatim %}
    <script id="passwordRowTpl" type="text/html">
        <td>
            <a href="{{ url }}" target="_blank">
                {{ title }}
            </a>
        </td>
        <td>{{ username }}</td>
        <td class="password">{{ maskedPassword }}</td>
        <td>{{ notes }}</td>
        <td>
            <a href="#" class="edit" title="Edit this entry"><i class="icon-pencil"></i></a>
            <a href="#" class="destroy" title="Delete this entry"><i class="icon-remove"></i></a>
        </td>
    </script>

    <script id="contactRowTpl" type="text/html">
        <td>
            {{ to_user.first_name }} {{ to_user.last_name }}
        </td>
        <td>{{ to_user.username }}</td>
        <td>
            <a href="#" class="destroy" title="Delete this entry"><i class="icon-remove"></i></a>
        </td>
    </script>
    {% endverbatim %}
{% endblock %}